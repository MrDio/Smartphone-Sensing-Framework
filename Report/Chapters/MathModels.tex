\chapter{Mathematical Models of Identifying Sections}

\section{Data Analysis}
The following section describes the data used. To ensure that the data recorded via the accelerometer can be evaluated, modifications such as smoothing and noise filtering had to be made. These are described below. But first the used data model is shown.

\subsection{Data Model}
The used Model consists of four parameters:
\begin{itemize}
	\item \textbf{Round}: represents the current lap
	\item \textbf{Time Stamp}: represents the current time stamp for each step
	\item \textbf{X-Acceleration}: represents the force that indicates curves
	\item \textbf{Y-Acceleration}: represents the force that indicates the acceleration of the vehicle
\end{itemize}
The reason, why only the forces in x- and y-directions are used, is that the device lies flat on the vehicle. In this case the z-acceleration only indicates the force of gravity, which is not necessary for this work.\\
The round is not altered, therefore it will not be mentioned any further. 

For the initial data one entry containing the four parameters is taken every 10 milliseconds. Figure \ref{fig:origFor} shows the forces for one lap in the original data.

\begin{figure}[H]
	\centering
	\includegraphics[scale= 0.42]{Pictures/originalForces.png}
	\caption{Visualization of the forces in the original data}
	\label{fig:origFor}
\end{figure}

This figure shows clearly that a analysis on base of the unfiltered data is simply impossible. Therefore as a first step data smoothing is used which is described in the following.

\subsection{Smoothing}
One problem that was identified is that there are to many measured points over time. So at first every four to five measured points were summed up and the average was used. This resulted in a better graph, which is shown in figure \ref{fig:smoFor}.

\begin{figure}[H]
	\centering
	\includegraphics[scale= 0.45]{Pictures/smoothedForces.png}
	\caption{Visualization of the forces of the smoothed data}
	\label{fig:smoFor}
\end{figure}

In this figure it is possible for the human eye to distinguish between sections like left and right curves. But because of the noise, it would still be difficult for a computer. So a noise filter had to be used. It is described in the following section.

\subsection{Savitzky-Golay Filtering}
This filter is used to increase the signal-to-noise-ratio of a digital data set\cite{sg}. Therefore it would perfectly fit the requirement. It requires a data set consisting of $n$ points $(x,y)$ where x is an independent variable and y is the observed value. In this case $x$ is the time stamp, while $y$ is the force in x-/y- direction. In addition a set of $m$ convolution coefficients $C_i$ are needed which results in following equation:
\begin{equation*}
	Y_j = \sum_{i=-\frac{m-1}{2}}^{\frac{m-1}{2}}\dfrac{C_i\cdot y_{j+i}}{h},~~~~~~~ \dfrac{m-1}{2}\leq j \leq n-\dfrac{m-1}{2}
\end{equation*}
Because of the high sample rate in this project a relatively high value for $m=9$ was used. Therefore 9 convolution coefficients were used:
\begin{equation*}
	\begin{split}
	C_{-4} & = -21\\
	C_{-3} & = 14\\
	C_{-2} & = 39\\
	C_{-1} & = 54\\
	C_{0} & = 59   \\
	C_{1} & = 54     \\
	C_{2} & = 39     \\
	C_{3} & = 14     \\
	C_{4} & = -21    \\
	\end{split}
\end{equation*}
The sum of these coefficients is used for the normalisation $h=231$.

Applying this filter on the not smoothed original data results in a graph shown in figure \ref{fig:sgoriFor}.

\begin{figure}[H]
	\centering
	\includegraphics[scale= 0.45]{Pictures/sgoriForces.png}
	\caption{Visualization of the forces of the applied filter on the original data}
	\label{fig:sgoriFor}
\end{figure}

This proves, that a pre-smoothing might be needed to get a less noisy graph. Therefore figure \ref{fig:sgFor} shows the graph that is accomplished after applying both methods.

\begin{figure}[H]
	\centering
	\includegraphics[scale= 0.45]{Pictures/sgForces.png}
	\caption{Visualization of the forces of the applied filter on the smoothed data}
	\label{fig:sgFor}
\end{figure}

With all this smoothing and filtering it is now possible for a computer to identify sections, which is described in the next section.

\newpage
\section{Section Identification}
The following section will describe the solution for the identification of sections. And is split into two parts. The first explains the rough identification of sections. These sections will then be given to a classification method that clearly identifies the type of section, be it a curve or a straight line. 

\subsection{Identification}
The identification is split into three parts that will be executed serial. After smoothing and filtering of the dataset. The x-axis acceleration values will be split into two groups. This split is happening with a singular x value representing a threshold. In the positive and negative acceleration range. A visual representation of the threshold can be seen in figure \ref{upperlowerBound}. in this case, the threshold is set to 3.5. All points below the lower bound and above the upper bound will be grouped inside a dataset, while all the points in between are grouped in another.
\begin{figure}[H]
	\centering
	\includegraphics[scale= 0.6]{Pictures/upperandlowerbound.png}
	\caption{Visualization of the thresholds for the upper and lower dataset}
	\label{upperlowerBound}
\end{figure}
After separating the datasets with the threshold, the points above the threshold are considered as expected curves. Therefore it is cleaned in a second step. Because a curve cannot be created with only one point above the threshold, single points will be put back into the dataset in between the thresholds. The last step is grouping the points into sections. The points in between are created as new sections with ten points. A section, that is above the threshold will be created with the first point above and the last point above.

\subsection{Classification}

\section{Section Rating}
Because the focus of our project was the identification of sections, the section rating part contains a simple implementation. The core principle is determining the fastest lap and comparing the time footprint of the other sections to the sections of the fastest lap. Because in our model, a straight is following on a curve and vice versa, the following mappings are created. Figure \ref{StraightResultMapping} shows the mapping for a straight and the timestamp configurations while figure \ref{CurveResultMapping} shows the same for the curve. The green and red markings are showing, if the current lap is faster(green) or slower(red) on the current section than the fastest lap, that is chosen as reference.
\begin{figure}[H]
	\centering
	\includegraphics[scale= 0.9]{Pictures/StraightResultMapping.png}
	\caption{Mapping of the timestamps to the tips for a section, that is a straight}
	\label{StraightResultMapping}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[scale= 0.9]{Pictures/CurveResultMapping.png}
	\caption{Mapping of the timestamps to the tips for a section, that is a curve}
	\label{CurveResultMapping}
\end{figure}
